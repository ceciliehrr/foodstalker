---
import getRecipes from "../data/recipes.json";
import Layout from "../layouts/Layout.astro";
import Card from "../components/cards/Card.astro";
import Grid from "../components/Grid.vue";
import Divider from "../components/Divider.astro";
import { getTheme, getAllThemeSlugs } from "../config/themes.js";

export async function getStaticPaths() {
  const themeSlugs = getAllThemeSlugs();

  return themeSlugs.map((slug) => ({
    params: { theme: slug },
    props: {},
  }));
}

const { theme } = Astro.params;
const themeConfig = getTheme(theme);

// Return 404 if theme doesn't exist
if (!themeConfig) {
  return Astro.redirect("/404");
}

const recipes = getRecipes;
const filteredRecipes = recipes.filter((recipe) =>
  recipe.keywords.includes(themeConfig.keyword)
);

function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}
---

<Layout title={themeConfig.title} description={themeConfig.description}>
  <div class="fs-category__emoji">
    <img
      src={themeConfig.emoji.src}
      alt={`${themeConfig.keyword} emoji`}
      aria-hidden="true"
    />
  </div>

  {
    themeConfig.dividerText && (
      <Divider text={capitalizeFirstLetter(themeConfig.dividerText)} />
    )
  }

  {themeConfig.introText && <p>{themeConfig.introText}</p>}

  <Divider />
  <Grid>
    {
      filteredRecipes.map((data) => (
        <Card
          href={"/oppskrift/" + data.id}
          title={data.title}
          emoji={data.category}
          image={data.imageurl}
          description={data.description}
          date={data.date}
          recipe={data}
        />
      ))
    }
  </Grid>
</Layout>

<style lang="scss" scoped>
  @use "sass:map";
  @use "../styles/variables/" as *;
  @use "../styles/mixins/breakpoints" as *;

  .fs-category__emoji {
    display: grid;
    justify-content: center;

    color: var(--fs-black);
    animation: sway 3s cubic-bezier(0.4, 0, 0.2, 1) infinite; /* Myk bevegelse */

    /* Jevnere keyframes for swaying */
    @keyframes sway {
      0% {
        transform: rotate(0deg);
      }
      25% {
        transform: rotate(7deg);
      }
      50% {
        transform: rotate(0deg);
      }
      75% {
        transform: rotate(-7deg);
      }
      100% {
        transform: rotate(0deg);
      }
    }
    & img {
      width: 4rem;
      @include bp("tablet-up") {
        width: 8rem;
      }
      @include bp("tablet-big-up") {
        width: 12rem;
      }
    }
  }
</style>
